<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Calendario Azteco - Analisi e Strumenti</title>
  <style>
    /* Reset e transizioni */
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #121212;
      color: #e0e0e0;
      padding: 20px;
      line-height: 1.6;
      text-align: center;
    }
    body.light-theme {
      background-color: #f5f5f5;
      color: #333;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 20px;
      padding: 20px;
    }
    .section {
      background: #1e1e1e;
      border: 1px solid #333;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.8);
    }
    body.light-theme .section {
      background: #fff;
      border: 1px solid #ccc;
      box-shadow: 0 4px 6px rgba(0,0,0,0.2);
    }
    h1, h2 {
      margin-bottom: 15px;
    }
    p {
      margin-bottom: 10px;
      font-size: 1rem;
    }
    input[type="date"],
    input[type="number"],
    input[type="text"],
    select,
    button {
      width: 100%;
      padding: 12px 15px;
      margin-bottom: 10px;
      font-size: 1rem;
      border: 1px solid #555;
      border-radius: 5px;
      background-color: #2c2c2c;
      color: #e0e0e0;
      text-align: center;
    }
    body.light-theme input,
    body.light-theme select,
    body.light-theme button {
      background-color: #e0e0e0;
      color: #333;
      border: 1px solid #ccc;
    }
    button {
      background: #333;
      color: #fff;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background: #444;
    }
    #result, #searchResults, #liveConversion, #astroData, #sumResult, #astroEvents {
      margin-top: 10px;
    }
    .theme-toggle {
      text-align: right;
      margin-bottom: 10px;
    }
    /* Stili per la griglia del glossario */
    .glossary-grid {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }
    .glossary-item {
      width: 80px;
      cursor: pointer;
    }
    .glossary-item img {
      width: 100%;
      border-radius: 5px;
      border: 1px solid #555;
    }
    .glossary-item span {
      font-size: 0.8rem;
      display: block;
      margin-top: 5px;
    }
    /* Modal per il glossario */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.7);
    }
    .modal-content {
      background-color: #1e1e1e;
      margin: 10% auto;
      padding: 20px;
      border: 1px solid #888;
      max-width: 400px;
      border-radius: 10px;
      text-align: left;
    }
    body.light-theme .modal-content {
      background-color: #fff;
      color: #333;
    }
    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
    .close:hover,
    .close:focus {
      color: #fff;
      text-decoration: none;
    }
    @media (max-width: 600px) {
      body {
        padding: 10px;
      }
      .container {
        padding: 10px;
      }
      input, select, button {
        padding: 10px;
        font-size: 0.9rem;
      }
    }
  </style>
</head>
<body>
  <div class="theme-toggle">
    <label for="themeSwitch">Tema chiaro</label>
    <input type="checkbox" id="themeSwitch">
  </div>
  <div class="container">
    <!-- Sezione Conversione Live del Giorno -->
    <div class="section" id="liveConversionSection">
      <h2>Conversione Live del Giorno</h2>
      <div id="liveConversion">Caricamento conversione live...</div>
    </div>

    <!-- Sezione Convertitore Calendario -->
    <div class="section" id="converterSection">
      <h1>Convertitore Calendario</h1>
      <p>Inserisci una data del calendario gregoriano:</p>
      <input type="date" id="inputDate">
      <button id="convertButton">Converti</button>
      <div id="result"></div>
    </div>

    <!-- Sezione: Somma Conversioni di Due Date -->
    <div class="section" id="sumSection">
      <h2>Somma Conversioni di Due Date</h2>
      <p>Inserisci la prima data:</p>
      <input type="date" id="firstDate">
      <p>Inserisci la seconda data:</p>
      <input type="date" id="secondDate">
      <button id="sumButton">Calcola Somma</button>
      <div id="sumResult"></div>
    </div>

    <!-- Sezione Cerca Date per Numero di Destino e Filtri -->
    <div class="section" id="destinySearchSection">
      <h2>Cerca Date per Numero di Destino e Filtri</h2>
      <p>Scegli criterio filtro:</p>
      <select id="filterCriterion">
         <option value="">-- Seleziona criterio --</option>
         <option value="destiny">Numero Destino</option>
         <option value="civilDay">Giorno Civile</option>
         <option value="civilMonth">Mese Civile</option>
         <option value="sacredDay">Giorno Sacro</option>
         <option value="sacredSymbol">Simbolo Sacro</option>
      </select>
      <div id="filterInputArea"></div>
      <p>Data Iniziale:</p>
      <input type="date" id="startDate">
      <p>Data Finale:</p>
      <input type="date" id="endDate">
      <button id="searchButton">Cerca Date</button>
      <div id="searchResults"></div>
    </div>

    <!-- Sezione Dati Astronomici Live -->
    <div class="section" id="astroSection">
      <h2>Dati Astronomici Live</h2>
      <div id="astroData">Caricamento dati astronomici...</div>
    </div>

    <!-- Sezione Eventi Astronomici -->
    <div class="section" id="astroEventsSection">
      <h2>Eventi Astronomici</h2>
      <button id="loadEventsButton">Carica Eventi</button>
      <div id="astroEvents">Caricamento eventi...</div>
    </div>

    <!-- Sezione: Simbologia e Mitologia (Glossario Interattivo) -->
    <div class="section" id="glossarySection">
      <h2>Simbologia e Mitologia</h2>
      <p>Clicca su ciascun simbolo per conoscere il suo significato, la relativa deità e il mito associato.</p>
      <div class="glossary-grid">
        <!-- L'ordine segue quello dell'array sacredDayNames -->
        <div class="glossary-item" data-symbol="Cipactli (Coccodrillo)">
          <img src="calendariov1/Images/Coccodrillo.png" alt="Coccodrillo">
          <span>Cipactli</span>
        </div>
        <div class="glossary-item" data-symbol="Ehecatl (Vento)">
          <img src="calendariov1/Images/Vento.png" alt="Vento">
          <span>Ehecatl</span>
        </div>
        <div class="glossary-item" data-symbol="Calli (Casa)">
          <img src="calendariov1/Images/Casa.png" alt="Casa">
          <span>Calli</span>
        </div>
        <div class="glossary-item" data-symbol="Cuetzpalin (Lucertola)">
          <img src="calendariov1/Images/Lucertola.png" alt="Lucertola">
          <span>Cuetzpalin</span>
        </div>
        <div class="glossary-item" data-symbol="Coatl (Serpente)">
          <img src="calendariov1/Images/Serpente.png" alt="Serpente">
          <span>Coatl</span>
        </div>
        <div class="glossary-item" data-symbol="Miquiztli (Morte)">
          <img src="calendariov1/Images/Morte.png" alt="Morte">
          <span>Miquiztli</span>
        </div>
        <div class="glossary-item" data-symbol="Mazatl (Cervo)">
          <img src="calendariov1/Images/Cervo.png" alt="Cervo">
          <span>Mazatl</span>
        </div>
        <div class="glossary-item" data-symbol="Tochtli (Coniglio)">
          <img src="calendariov1/Images/Coniglio.png" alt="Coniglio">
          <span>Tochtli</span>
        </div>
        <div class="glossary-item" data-symbol="Atl (Acqua)">
          <img src="calendariov1/Images/Acqua.png" alt="Acqua">
          <span>Atl</span>
        </div>
        <div class="glossary-item" data-symbol="Itzcuintli (Cane)">
          <img src="calendariov1/Images/Cane.png" alt="Cane">
          <span>Itzcuintli</span>
        </div>
        <div class="glossary-item" data-symbol="Ozomahtli (Scimmia)">
          <img src="calendariov1/Images/Scimmia.png" alt="Scimmia">
          <span>Ozomahtli</span>
        </div>
        <div class="glossary-item" data-symbol="Malinalli (Erba)">
          <img src="calendariov1/Images/Erba.png" alt="Erba">
          <span>Malinalli</span>
        </div>
        <div class="glossary-item" data-symbol="Acatl (Canna)">
          <img src="calendariov1/Images/Canna.png" alt="Canna">
          <span>Acatl</span>
        </div>
        <div class="glossary-item" data-symbol="Ocelotl (Giaguaro)">
          <img src="calendariov1/Images/Giaguaro.png" alt="Giaguaro">
          <span>Ocelotl</span>
        </div>
        <div class="glossary-item" data-symbol="Cuauhtli (Aquila)">
          <img src="calendariov1/Images/Aquila.png" alt="Aquila">
          <span>Cuauhtli</span>
        </div>
        <div class="glossary-item" data-symbol="Cozcacuauhtli (Avvoltoio)">
          <img src="calendariov1/Images/Avvoltoio.png" alt="Avvoltoio">
          <span>Cozcacuauhtli</span>
        </div>
        <div class="glossary-item" data-symbol="Ollin (Movimento)">
          <img src="calendariov1/Images/Movimento.png" alt="Movimento">
          <span>Ollin</span>
        </div>
        <div class="glossary-item" data-symbol="Tecpatl (Selce)">
          <img src="calendariov1/Images/Selce.png" alt="Selce">
          <span>Tecpatl</span>
        </div>
        <div class="glossary-item" data-symbol="Quiahuitl (Pioggia)">
          <img src="calendariov1/Images/Pioggia.png" alt="Pioggia">
          <span>Quiahuitl</span>
        </div>
        <div class="glossary-item" data-symbol="Xochitl (Fiore)">
          <img src="calendariov1/Images/Fiore.png" alt="Fiore">
          <span>Xochitl</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal per il glossario -->
  <div id="glossaryModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2 id="modalTitle">Titolo</h2>
      <img id="modalImage" src="" alt="" style="width:100%; border-radius: 5px;">
      <p id="modalDescription">Descrizione del simbolo e informazioni mitologiche...</p>
    </div>
  </div>

  <script>
    // Tema chiaro/scuro
    document.getElementById("themeSwitch").addEventListener("change", function() {
      if(this.checked) {
        document.body.classList.add("light-theme");
      } else {
        document.body.classList.remove("light-theme");
      }
    });

    /* --- Funzioni per Conversione e Dati Astronomici --- */
    const baseDate1965 = new Date(1965, 1, 21);
    const baseDate1913 = new Date(1913, 1, 21);

    function getNonLeapDayOfYear(date) {
      const monthLengths = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
      let dayOfYear = 0;
      for (let i = 0; i < date.getMonth(); i++) {
        dayOfYear += monthLengths[i];
      }
      dayOfYear += date.getDate();
      return dayOfYear;
    }

    const civilMonths = [
      { name: "Atlcahualo (o Cuauhitlehua)", days: 20 },
      { name: "Tlacaxipehualiztli", days: 20 },
      { name: "Tozoztontli", days: 20 },
      { name: "Huey Tozoztontli", days: 20 },
      { name: "Toxcatl", days: 20 },
      { name: "Etzalcualiztli", days: 20 },
      { name: "Tecuilhuitontli", days: 20 },
      { name: "Huey Tecuhuitl", days: 20 },
      { name: "Tlaxochimaco", days: 20 },
      { name: "Xocotl Huetzi", days: 20 },
      { name: "Ochpaniztli", days: 20 },
      { name: "Teotleco", days: 20 },
      { name: "Tepeilhuitl", days: 20 },
      { name: "Quecholli", days: 20 },
      { name: "Panquetzaliztli", days: 20 },
      { name: "Atemoztli", days: 20 },
      { name: "Tititl", days: 20 },
      { name: "Izcalli", days: 20 }
    ];

    const sacredDayNames = [
      "Cipactli (Coccodrillo)",
      "Ehecatl (Vento)",
      "Calli (Casa)",
      "Cuetzpalin (Lucertola)",
      "Coatl (Serpente)",
      "Miquiztli (Morte)",
      "Mazatl (Cervo)",
      "Tochtli (Coniglio)",
      "Atl (Acqua)",
      "Itzcuintli (Cane)",
      "Ozomahtli (Scimmia)",
      "Malinalli (Erba)",
      "Acatl (Canna)",
      "Ocelotl (Giaguaro)",
      "Cuauhtli (Aquila)",
      "Cozcacuauhtli (Avvoltoio)",
      "Ollin (Movimento)",
      "Tecpatl (Selce)",
      "Quiahuitl (Pioggia)",
      "Xochitl (Fiore)"
    ];

    function getMonthNumber(civilMonthName) {
      for (let i = 0; i < civilMonths.length; i++) {
        if (civilMonths[i].name === civilMonthName) {
          return i + 1;
        }
      }
      return 0;
    }

    function computeConversion(inputDate) {
      const selectedDate = new Date(inputDate);
      selectedDate.setHours(12, 0, 0, 0);
      if (selectedDate < baseDate1913) {
        return { error: "La data è precedente al 2 febbraio 1913." };
      }
      let baseDateUsed = (selectedDate < baseDate1965) ? baseDate1913 : baseDate1965;
      const baseDOY = getNonLeapDayOfYear(baseDateUsed);
      const selectedDOY = getNonLeapDayOfYear(selectedDate);
      const yearDiff = selectedDate.getFullYear() - baseDateUsed.getFullYear();
      const diff = yearDiff * 365 + (selectedDOY - baseDOY);

      const civilDay = diff % 365;
      let remainingDays = civilDay;
      let civilMonthName = "";
      let civilDayNumber = 0;
      for (let i = 0; i < civilMonths.length; i++) {
        if (remainingDays < civilMonths[i].days) {
          civilMonthName = civilMonths[i].name;
          civilDayNumber = remainingDays + 1;
          break;
        } else {
          remainingDays -= civilMonths[i].days;
        }
      }
      if (civilMonthName === "") {
        civilMonthName = "Nemontemi (5 giorni infausti)";
        civilDayNumber = remainingDays + 1;
      }

      const sacredDayIndex = diff % 260;
      const sacredNumber = (sacredDayIndex % 13) + 1;
      const sacredName = sacredDayNames[sacredDayIndex % 20];
      const cycleUsed = (selectedDate < baseDate1965) ? "Ciclo 1913" : "Ciclo 1965";
      const mindNumber = sacredDayNames.indexOf(sacredName) + 1;
      const destinyNumber = civilDayNumber + mindNumber + sacredNumber;

      return {
        civil: { month: civilMonthName, day: civilDayNumber },
        sacred: { number: sacredNumber, name: sacredName },
        cycle: cycleUsed,
        mindNumber: mindNumber,
        destiny: destinyNumber
      };
    }

    function computeMoonPhaseStart(now) {
      const synodicMonth = 29.53058867;
      const knownNewMoon = new Date(Date.UTC(2000, 0, 6, 18, 14, 0));
      const elapsedDays = (now.getTime() - knownNewMoon.getTime()) / 86400000;
      const wholePeriod = Math.floor(elapsedDays / synodicMonth);
      const currentPhase = elapsedDays % synodicMonth;
      
      const lunarPhases = [
        { name: "Novilunio", start: 0, end: 1.84566 },
        { name: "Crescente", start: 1.84566, end: 5.53699 },
        { name: "Primo Quarto", start: 5.53699, end: 9.22831 },
        { name: "Gibbosa Crescente", start: 9.22831, end: 12.91963 },
        { name: "Piena", start: 12.91963, end: 16.61096 },
        { name: "Gibbosa Calante", start: 16.61096, end: 20.30228 },
        { name: "Ultimo Quarto", start: 20.30228, end: 23.99361 },
        { name: "Calante", start: 23.99361, end: 27.68493 },
        { name: "Novilunio", start: 27.68493, end: synodicMonth }
      ];
      
      let phaseStartThreshold = 0;
      let computedPhaseName = "";
      for (let i = 0; i < lunarPhases.length; i++) {
        if (currentPhase >= lunarPhases[i].start && currentPhase < lunarPhases[i].end) {
          phaseStartThreshold = lunarPhases[i].start;
          computedPhaseName = lunarPhases[i].name;
          break;
        }
      }
      const phaseStartAbsoluteMs = knownNewMoon.getTime() + (wholePeriod * synodicMonth + phaseStartThreshold) * 86400000;
      const phaseStartDate = new Date(phaseStartAbsoluteMs);
      const options = { hour: '2-digit', minute: '2-digit', timeZone: 'Europe/Rome' };
      const phaseStartStr = phaseStartDate.toLocaleTimeString('it-IT', options);
      return { moonPhaseName: computedPhaseName, phaseStartStr: phaseStartStr };
    }

    function updateLiveConversion() {
      const today = new Date();
      const result = computeConversion(today);
      const liveDiv = document.getElementById("liveConversion");
      if (result.error) {
        liveDiv.textContent = result.error;
      } else {
        const civilMonthNumber = getMonthNumber(result.civil.month);
        liveDiv.innerHTML = 
          `<p><strong>Spirito:</strong> ${result.civil.day}</p>
           <p><strong>Mente:</strong> ${result.mindNumber}</p>
           <p><strong>Anima:</strong> ${result.sacred.number}</p>
           <p><strong>Simbolo:</strong> ${result.sacred.name}</p>
           <p><strong>Mese Civile:</strong> ${civilMonthNumber} - ${result.civil.month}</p>
           <p><strong>Numero di Destino:</strong> ${result.destiny}</p>
           <p><em>${result.cycle}</em></p>`;
      }
    }

    function updateAstroData() {
      const now = new Date();
      const apiUrl = "https://api.sunrise-sunset.org/json?lat=41.9028&lng=12.4964&formatted=0&date=" + now.toISOString().split('T')[0];
      fetch(apiUrl)
        .then(response => response.json())
        .then(data => {
          if (data.status === "OK") {
            const options = { hour: '2-digit', minute: '2-digit', timeZone: 'Europe/Rome' };
            const sunriseUTC = new Date(data.results.sunrise);
            const sunsetUTC = new Date(data.results.sunset);
            const sunrise = sunriseUTC.toLocaleTimeString('it-IT', options);
            const sunset = sunsetUTC.toLocaleTimeString('it-IT', options);
            updateMoonPhase(sunrise, sunset, now);
          } else {
            document.getElementById("astroData").innerHTML = "<p>Errore nel recupero dati solari.</p>";
          }
        })
        .catch(error => {
          console.error("Errore nel fetch dei dati solari:", error);
          document.getElementById("astroData").innerHTML = "<p>Errore nel recupero dati astronomici.</p>";
        });
    }

    function updateMoonPhase(sunrise, sunset, now) {
      const options = { hour: '2-digit', minute: '2-digit', timeZone: 'Europe/Rome' };
      const moonApiUrl = "https://api.farmsense.net/v1/moonphases/?d=" + Math.floor(now.getTime() / 86400000);
      fetch(moonApiUrl)
        .then(response => response.json())
        .then(moonData => {
          if (moonData && moonData.length > 0) {
            const phaseInfo = moonData[0];
            let moonPhaseName = phaseInfo.Phase;
            let phaseStartStr;
            if (phaseInfo.Date) {
              phaseStartStr = new Date(phaseInfo.Date).toLocaleTimeString('it-IT', options);
            } else {
              const computed = computeMoonPhaseStart(now);
              moonPhaseName = computed.moonPhaseName;
              phaseStartStr = computed.phaseStartStr;
            }
            const currentTime = now.toLocaleTimeString('it-IT', {hour: '2-digit', minute:'2-digit'});
            document.getElementById("astroData").innerHTML = 
              `<p><strong>Luna:</strong> Fase: ${moonPhaseName} (inizio: ${phaseStartStr})</p>
               <p><strong>Sole:</strong> Sorgere: ${sunrise} - Tramonto: ${sunset}</p>
               <p><strong>Ora attuale:</strong> ${currentTime}</p>`;
          } else {
            fallbackMoonPhase(sunrise, sunset, now);
          }
        })
        .catch(error => {
          console.error("Errore nel fetch per fase lunare:", error);
          fallbackMoonPhase(sunrise, sunset, now);
        });
    }

    function fallbackMoonPhase(sunrise, sunset, now) {
      const computed = computeMoonPhaseStart(now);
      const moonPhaseName = computed.moonPhaseName;
      const phaseStartStr = computed.phaseStartStr;
      const currentTime = now.toLocaleTimeString('it-IT', {hour: '2-digit', minute:'2-digit'});
      document.getElementById("astroData").innerHTML = 
        `<p><strong>Luna:</strong> Fase: ${moonPhaseName} (inizio: ${phaseStartStr})</p>
         <p><strong>Sole:</strong> Sorgere: ${sunrise} - Tramonto: ${sunset}</p>
         <p><strong>Ora attuale:</strong> ${currentTime}</p>`;
    }

    // Event listener per sommare le conversioni di due date
    document.getElementById("sumButton").addEventListener("click", () => {
      const firstDate = document.getElementById("firstDate").value;
      const secondDate = document.getElementById("secondDate").value;
      const sumResultDiv = document.getElementById("sumResult");
      if (!firstDate || !secondDate) {
        alert("Per favore, inserisci entrambe le date.");
        return;
      }
      const conv1 = computeConversion(firstDate);
      const conv2 = computeConversion(secondDate);
      if (conv1.error || conv2.error) {
        alert("Una o entrambe le date non sono valide.");
        return;
      }
      const sumSpirito = conv1.civil.day + conv2.civil.day;
      const sumMente = conv1.mindNumber + conv2.mindNumber;
      const sumAnima = conv1.sacred.number + conv2.sacred.number;
      const sumDestino = conv1.destiny + conv2.destiny;
      sumResultDiv.innerHTML = 
        `<p><strong>Spirito:</strong> ${sumSpirito}</p>
         <p><strong>Mente:</strong> ${sumMente}</p>
         <p><strong>Anima:</strong> ${sumAnima}</p>
         <p><strong>Numero di Destino:</strong> ${sumDestino}</p>`;
    });

    // Event listener per la ricerca con filtro
    document.getElementById("searchButton").addEventListener("click", () => {
      const criterion = document.getElementById("filterCriterion").value;
      const filterInputElement = document.getElementById("filterInput");
      const filterValue = filterInputElement ? filterInputElement.value : "";
      const startDate = document.getElementById("startDate").value;
      const endDate = document.getElementById("endDate").value;
      const searchResultsDiv = document.getElementById("searchResults");

      if (!startDate || !endDate) {
        alert("Per favore, inserisci la data iniziale e la data finale.");
        return;
      }
      
      const datesFound = searchDatesByFilter(criterion, filterValue, startDate, endDate);
      if (datesFound.length === 0) {
        searchResultsDiv.innerHTML = "<p>Nessuna data trovata con i criteri inseriti.</p>";
      } else {
        searchResultsDiv.innerHTML = "<p>Date trovate:</p><ul>" +
          datesFound.map(date => `<li>${date}</li>`).join('') +
          "</ul>";
      }
    });

    function searchDatesByFilter(criterion, target, startDateStr, endDateStr) {
      const results = [];
      let currentDate = new Date(startDateStr);
      const endDate = new Date(endDateStr);
      currentDate.setHours(12,0,0,0);
      endDate.setHours(12,0,0,0);
      while (currentDate <= endDate) {
        const conv = computeConversion(currentDate);
        if (conv.error) {
          currentDate.setDate(currentDate.getDate() + 1);
          continue;
        }
        let match = true;
        if (criterion && target !== "") {
          switch (criterion) {
            case "destiny":
              if (conv.destiny !== parseInt(target)) match = false;
              break;
            case "civilDay":
              if (conv.civil.day !== parseInt(target)) match = false;
              break;
            case "civilMonth":
              if (getMonthNumber(conv.civil.month) !== parseInt(target)) match = false;
              break;
            case "sacredDay":
              if (conv.sacred.number !== parseInt(target)) match = false;
              break;
            case "sacredSymbol":
              if (conv.sacred.name.toLowerCase() !== target.toLowerCase()) match = false;
              break;
            default:
              break;
          }
        }
        if (match) {
          results.push(currentDate.toISOString().split('T')[0]);
        }
        currentDate.setDate(currentDate.getDate() + 1);
      }
      return results;
    }

    // Glossario Interattivo
    const symbolDetails = {
      "Cipactli (Coccodrillo)": "Simbolo del coccodrillo, rappresenta la forza primordiale e la creazione.",
      "Ehecatl (Vento)": "Simbolo del vento, associato a Ehecatl, il dio del vento e dell'aria.",
      "Calli (Casa)": "Simbolo della casa, rappresenta il rifugio e la famiglia.",
      "Cuetzpalin (Lucertola)": "Simbolo della lucertola, legato alla vitalità e al movimento.",
      "Coatl (Serpente)": "Simbolo del serpente, emblema di trasformazione e rinnovamento.",
      "Miquiztli (Morte)": "Simbolo della morte, riflette il ciclo della vita e della rinascita.",
      "Mazatl (Cervo)": "Simbolo del cervo, associato alla grazia e alla natura.",
      "Tochtli (Coniglio)": "Simbolo del coniglio, legato alla fertilità e alla rinascita.",
      "Atl (Acqua)": "Simbolo dell'acqua, elemento vitale e purificatore.",
      "Itzcuintli (Cane)": "Simbolo del cane, fedele compagno e guida spirituale.",
      "Ozomahtli (Scimmia)": "Simbolo della scimmia, rappresenta l'intelligenza e l'adattabilità.",
      "Malinalli (Erba)": "Simbolo dell'erba, associato alla natura e alla rinascita.",
      "Acatl (Canna)": "Simbolo della canna, legato all'abbondanza e alla crescita.",
      "Ocelotl (Giaguaro)": "Simbolo del giaguaro, emblema di forza e potere.",
      "Cuauhtli (Aquila)": "Simbolo dell'aquila, rappresenta la visione e il coraggio.",
      "Cozcacuauhtli (Avvoltoio)": "Simbolo dell'avvoltoio, collegato alla trasformazione e al ciclo della vita.",
      "Ollin (Movimento)": "Simbolo del movimento, indicativo del cambiamento costante.",
      "Tecpatl (Selce)": "Simbolo della selce, associato al potere e alla forza rituale.",
      "Quiahuitl (Pioggia)": "Simbolo della pioggia, fondamentale per la fertilità della terra.",
      "Xochitl (Fiore)": "Simbolo del fiore, emblema della bellezza e della rinascita."
    };

    const modal = document.getElementById("glossaryModal");
    const modalTitle = document.getElementById("modalTitle");
    const modalImage = document.getElementById("modalImage");
    const modalDescription = document.getElementById("modalDescription");
    const closeModal = document.getElementsByClassName("close")[0];

    document.querySelectorAll(".glossary-item").forEach(item => {
      item.addEventListener("click", () => {
        const symbol = item.getAttribute("data-symbol");
        modalTitle.textContent = symbol.split(" (")[0];
        modalImage.src = item.querySelector("img").src;
        modalImage.alt = symbol;
        modalDescription.textContent = symbolDetails[symbol] || "Descrizione non disponibile.";
        modal.style.display = "block";
      });
    });

    closeModal.onclick = function() {
      modal.style.display = "none";
    }
    window.onclick = function(event) {
      if (event.target == modal) {
        modal.style.display = "none";
      }
    }

    // Inizializzazione al caricamento
    updateLiveConversion();
    updateAstroData();
    setInterval(() => {
      updateLiveConversion();
      updateAstroData();
    }, 60000);
  </script>
</body>
</html>
