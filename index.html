<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Convertitore Calendario e Dati Astronomici</title>
  <style>
    /* Reset base */
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #fff;
      color: #000;
      line-height: 1.6;
      padding: 20px;
    }
    .container {
      max-width: 800px;
      margin: 20px auto;
      padding: 0 20px;
    }
    .section {
      background: #f4f4f4;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    h1, h2 {
      text-align: center;
      margin-bottom: 15px;
    }
    p {
      margin-bottom: 10px;
      font-size: 1rem;
    }
    input[type="date"],
    button {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    button {
      background: #000;
      color: #fff;
      border: none;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    button:hover {
      background: #333;
    }
    /* Responsive per dispositivi mobili */
    @media (max-width: 600px) {
      body {
        padding: 10px;
      }
      .container {
        padding: 10px;
      }
      input, button {
        padding: 10px;
        font-size: 0.9rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Sezione Conversione Calendario -->
    <section id="conversione" class="section">
      <h1>Convertitore Calendario</h1>
      <p>Inserisci una data del calendario gregoriano:</p>
      <input type="date" id="inputDate">
      <button id="convertButton">Converti</button>
      <div id="result"></div>
    </section>

    <!-- Sezione Dati della Luna e del Sole -->
    <section id="astronomia" class="section">
      <h2>Dati della Luna e del Sole</h2>
      <p><strong>Luna:</strong> Fase attuale: <span id="moonPhase">-</span></p>
      <p><strong>Sole:</strong> Alba: <span id="sunrise">-</span> - Tramonto: <span id="sunset">-</span></p>
    </section>
  </div>

  <script>
    // Date base per la conversione
    const baseDate1965 = new Date(1965, 1, 21);
    const baseDate1913 = new Date(1913, 1, 21);

    // Funzione per calcolare il giorno dell'anno (ignorando gli anni bisestili)
    function getNonLeapDayOfYear(date) {
      const monthLengths = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
      let dayOfYear = 0;
      for (let i = 0; i < date.getMonth(); i++) {
        dayOfYear += monthLengths[i];
      }
      dayOfYear += date.getDate();
      return dayOfYear;
    }

    // Array dei mesi civili
    const civilMonths = [
      { name: "Atlcahualo (o Cuauhitlehua)", days: 20 },
      { name: "Tlacaxipehualiztli", days: 20 },
      { name: "Tozoztontli", days: 20 },
      { name: "Huey Tozoztontli", days: 20 },
      { name: "Toxcatl", days: 20 },
      { name: "Etzalcualiztli", days: 20 },
      { name: "Tecuilhuitontli", days: 20 },
      { name: "Huey Tecuhuitl", days: 20 },
      { name: "Tlaxochimaco", days: 20 },
      { name: "Xocotl Huetzi", days: 20 },
      { name: "Ochpaniztli", days: 20 },
      { name: "Teotleco", days: 20 },
      { name: "Tepeilhuitl", days: 20 },
      { name: "Quecholli", days: 20 },
      { name: "Panquetzaliztli", days: 20 },
      { name: "Atemoztli", days: 20 },
      { name: "Tititl", days: 20 },
      { name: "Izcalli", days: 20 }
    ];
    const nemontemiDays = 5;

    // Array dei nomi sacri
    const sacredDayNames = [
      "Cipactli (Coccodrillo)",
      "Ehecatl (Vento)",
      "Calli (Casa)",
      "Cuetzpalin (Lucertola)",
      "Coatl (Serpente)",
      "Miquiztli (Morte)",
      "Mazatl (Cervo)",
      "Tochtli (Coniglio)",
      "Atl (Acqua)",
      "Itzcuintli (Cane)",
      "Ozomahtli (Scimmia)",
      "Malinalli (Erba)",
      "Acatl (Canna)",
      "Ocelotl (Giaguaro)",
      "Cuauhtli (Aquila)",
      "Cozcacuauhtli (Avvoltoio)",
      "Ollin (Movimento)",
      "Tecpatl (Coltello di selce)",
      "Quiahuitl (Pioggia)",
      "Xochitl (Fiore)"
    ];

    // Funzione per ottenere il numero del mese civile (per visualizzazione)
    function getMonthNumber(civilMonthName) {
      for (let i = 0; i < civilMonths.length; i++) {
        if (civilMonths[i].name === civilMonthName) {
          return i + 1;
        }
      }
      return 0;
    }

    // Funzione per calcolare la conversione e il Numero di Destino
    function computeConversion(inputDate) {
      const selectedDate = new Date(inputDate);
      selectedDate.setHours(12, 0, 0, 0);
      if (selectedDate < baseDate1913) {
        return { error: "La data Ã¨ precedente al 2 febbraio 1913." };
      }
      let baseDateUsed = (selectedDate < baseDate1965) ? baseDate1913 : baseDate1965;
      const baseDOY = getNonLeapDayOfYear(baseDateUsed);
      const selectedDOY = getNonLeapDayOfYear(selectedDate);
      const yearDiff = selectedDate.getFullYear() - baseDateUsed.getFullYear();
      const diff = yearDiff * 365 + (selectedDOY - baseDOY);

      // Calcolo del giorno civile
      const civilDay = diff % 365;
      let remainingDays = civilDay;
      let civilMonthName = "";
      let civilDayNumber = 0;
      for (let i = 0; i < civilMonths.length; i++) {
        if (remainingDays < civilMonths[i].days) {
          civilMonthName = civilMonths[i].name;
          civilDayNumber = remainingDays + 1;
          break;
        } else {
          remainingDays -= civilMonths[i].days;
        }
      }
      if (civilMonthName === "") {
        civilMonthName = "Nemontemi (5 giorni infausti)";
        civilDayNumber = remainingDays + 1;
      }

      const sacredDayIndex = diff % 260;
      const sacredNumber = (sacredDayIndex % 13) + 1;
      const sacredName = sacredDayNames[sacredDayIndex % 20];
      const cycleUsed = (selectedDate < baseDate1965) ? "Ciclo 1913" : "Ciclo 1965";
      const mindNumber = sacredDayNames.indexOf(sacredName) + 1;
      const destinyNumber = civilDayNumber + mindNumber + sacredNumber;

      return {
        civil: { month: civilMonthName, day: civilDayNumber },
        sacred: { number: sacredNumber, name: sacredName },
        cycle: cycleUsed,
        mindNumber: mindNumber,
        destiny: destinyNumber
      };
    }

    // Funzione per aggiornare i dati della Luna e del Sole in base alla data scelta
    function updateAstroData(date) {
      // Calcolo della fase lunare (approssimato)
      const lp = 2551443; // durata di un ciclo lunare in secondi (approssimato)
      const now = date.getTime() / 1000;
      const newMoonEpoch = new Date(1970, 0, 7, 20, 35, 0).getTime() / 1000;
      const phase = ((now - newMoonEpoch) % lp) / lp;
      let moonPhase;
      if (phase < 0.02 || phase > 0.98) {
        moonPhase = "Novilunio";
      } else if (phase < 0.25) {
        moonPhase = "Crescente";
      } else if (phase < 0.5) {
        moonPhase = "Gibbosa crescente";
      } else if (phase < 0.75) {
        moonPhase = "Gibbosa calante";
      } else {
        moonPhase = "Calante";
      }
      document.getElementById("moonPhase").textContent = moonPhase;
      
      // Calcolo approssimativo di alba e tramonto basato sul mese
      const month = date.getMonth();
      let sunrise, sunset;
      if (month === 11 || month === 0 || month === 1) {
        sunrise = "07:00";
        sunset = "17:00";
      } else if (month >= 4 && month <= 6) {
        sunrise = "05:30";
        sunset = "20:00";
      } else {
        sunrise = "06:30";
        sunset = "19:00";
      }
      document.getElementById("sunrise").textContent = sunrise;
      document.getElementById("sunset").textContent = sunset;
    }

    // Gestione dell'evento per la conversione e l'aggiornamento dei dati astronomici
    document.getElementById("convertButton").addEventListener("click", () => {
      const inputDate = document.getElementById("inputDate").value;
      const resultDiv = document.getElementById("result");
      if (!inputDate) {
        alert("Per favore, inserisci una data valida.");
        return;
      }
      const result = computeConversion(inputDate);
      if (result.error) {
        alert(result.error);
      } else {
        const civilMonthNumber = getMonthNumber(result.civil.month);
        resultDiv.innerHTML = `
          <p><strong>Spirito:</strong> ${result.civil.day}</p>
          <p><strong>Mente:</strong> ${result.mindNumber}</p>
          <p><strong>Anima:</strong> ${result.sacred.number}</p>
          <p><strong>Simbolo:</strong> ${result.sacred.name}</p>
          <p><strong>Mese Civile:</strong> ${civilMonthNumber} - ${result.civil.month}</p>
          <p><strong>Numero di Destino:</strong> ${result.destiny}</p>
          <p><em>${result.cycle}</em></p>
        `;
        // Aggiorna i dati della Luna e del Sole in base alla data scelta
        updateAstroData(new Date(inputDate));
      }
    });
  </script>
</body>
</html>
