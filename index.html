<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Convertitore Calendario e Dati Astronomici</title>
  <style>
    /* Reset base */
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #fff;
      color: #000;
      line-height: 1.6;
      padding-bottom: 20px;
    }
    /* Header e menu a tendina */
    header {
      background: #000;
      color: #fff;
      padding: 10px 20px;
      position: relative;
    }
    .menu-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .logo {
      font-size: 1.5rem;
      font-weight: bold;
    }
    .menu-toggle {
      cursor: pointer;
      font-size: 1.2rem;
      background: none;
      border: none;
      color: #fff;
    }
    nav {
      display: none;
      flex-direction: column;
      background: #000;
      width: 100%;
      position: absolute;
      top: 100%;
      left: 0;
    }
    nav a {
      color: #fff;
      text-decoration: none;
      padding: 10px 20px;
      border-top: 1px solid #333;
    }
    nav a:hover {
      background: #333;
    }
    .menu-container.active nav {
      display: flex;
    }
    /* Contenitore principale */
    .container {
      max-width: 800px;
      margin: 20px auto;
      padding: 0 20px;
    }
    .section {
      background: #f4f4f4;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    h1, h2 {
      text-align: center;
      margin-bottom: 15px;
    }
    p {
      margin-bottom: 10px;
      font-size: 1rem;
    }
    input[type="date"], button {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    button {
      background: #000;
      color: #fff;
      border: none;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    button:hover {
      background: #333;
    }
    /* Canvas per vibrazioni sinusoidali */
    #sineCanvas {
      width: 100%;
      height: 150px;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 5px;
      display: block;
      margin: 0 auto;
    }
    /* Responsive per dispositivi mobili */
    @media (max-width: 600px) {
      header {
        padding: 10px;
      }
      .menu-container {
        flex-direction: column;
        align-items: flex-start;
      }
      nav a {
        padding: 10px;
      }
      input, button {
        padding: 10px;
        font-size: 0.9rem;
      }
    }
  </style>
</head>
<body>
  <!-- Header con menu a tendina -->
  <header>
    <div class="menu-container" id="menuContainer">
      <div class="logo">Astronomia</div>
      <button class="menu-toggle" onclick="toggleMenu()">Menu &#9776;</button>
      <nav id="navMenu">
        <a href="#conversione">Conversione Calendario</a>
        <a href="#astronomia">Luna &amp; Sole</a>
        <a href="#vibrazioni">Vibrazioni</a>
      </nav>
    </div>
  </header>

  <div class="container">
    <!-- Sezione Conversione Calendario -->
    <section id="conversione" class="section">
      <h1>Convertitore Calendario</h1>
      <p>Inserisci una data del calendario gregoriano:</p>
      <input type="date" id="inputDate">
      <button id="convertButton">Converti</button>
      <div id="result"></div>
    </section>

    <!-- Sezione Dati Luna e Sole -->
    <section id="astronomia" class="section">
      <h2>Dati della Luna e del Sole</h2>
      <div id="astroData">
        <p><strong>Luna:</strong> Fase attuale: <span id="moonPhase">Novilunio</span></p>
        <p><strong>Sole:</strong> Sorgere: <span id="sunrise">06:00</span> - Tramonto: <span id="sunset">18:00</span></p>
      </div>
    </section>

    <!-- Sezione Vibrazioni Sinusoidali -->
    <section id="vibrazioni" class="section">
      <h2>Vibrazioni Sinusoidali</h2>
      <canvas id="sineCanvas"></canvas>
    </section>
  </div>

  <script>
    // Funzione per attivare/disattivare il menu a tendina
    function toggleMenu() {
      document.getElementById('menuContainer').classList.toggle('active');
    }

    // Date base per la conversione
    const baseDate1965 = new Date(1965, 1, 21);
    const baseDate1913 = new Date(1913, 1, 21);

    // Funzione per calcolare il giorno dell'anno (ignorando gli anni bisestili)
    function getNonLeapDayOfYear(date) {
      const monthLengths = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
      let dayOfYear = 0;
      for (let i = 0; i < date.getMonth(); i++) {
        dayOfYear += monthLengths[i];
      }
      dayOfYear += date.getDate();
      return dayOfYear;
    }

    // Array dei mesi civili
    const civilMonths = [
      { name: "Atlcahualo (o Cuauhitlehua)", days: 20 },
      { name: "Tlacaxipehualiztli", days: 20 },
      { name: "Tozoztontli", days: 20 },
      { name: "Huey Tozoztontli", days: 20 },
      { name: "Toxcatl", days: 20 },
      { name: "Etzalcualiztli", days: 20 },
      { name: "Tecuilhuitontli", days: 20 },
      { name: "Huey Tecuhuitl", days: 20 },
      { name: "Tlaxochimaco", days: 20 },
      { name: "Xocotl Huetzi", days: 20 },
      { name: "Ochpaniztli", days: 20 },
      { name: "Teotleco", days: 20 },
      { name: "Tepeilhuitl", days: 20 },
      { name: "Quecholli", days: 20 },
      { name: "Panquetzaliztli", days: 20 },
      { name: "Atemoztli", days: 20 },
      { name: "Tititl", days: 20 },
      { name: "Izcalli", days: 20 }
    ];
    const nemontemiDays = 5;

    // Array dei nomi sacri
    const sacredDayNames = [
      "Cipactli (Coccodrillo)",
      "Ehecatl (Vento)",
      "Calli (Casa)",
      "Cuetzpalin (Lucertola)",
      "Coatl (Serpente)",
      "Miquiztli (Morte)",
      "Mazatl (Cervo)",
      "Tochtli (Coniglio)",
      "Atl (Acqua)",
      "Itzcuintli (Cane)",
      "Ozomahtli (Scimmia)",
      "Malinalli (Erba)",
      "Acatl (Canna)",
      "Ocelotl (Giaguaro)",
      "Cuauhtli (Aquila)",
      "Cozcacuauhtli (Avvoltoio)",
      "Ollin (Movimento)",
      "Tecpatl (Coltello di selce)",
      "Quiahuitl (Pioggia)",
      "Xochitl (Fiore)"
    ];

    // Funzione per ottenere il numero del mese civile (per visualizzazione)
    function getMonthNumber(civilMonthName) {
      for (let i = 0; i < civilMonths.length; i++) {
        if (civilMonths[i].name === civilMonthName) {
          return i + 1;
        }
      }
      return 0;
    }

    // Funzione per calcolare la conversione e il Numero di Destino
    function computeConversion(inputDate) {
      const selectedDate = new Date(inputDate);
      selectedDate.setHours(12, 0, 0, 0);
      if (selectedDate < baseDate1913) {
        return { error: "La data Ã¨ precedente al 2 febbraio 1913." };
      }
      let baseDateUsed = (selectedDate < baseDate1965) ? baseDate1913 : baseDate1965;
      const baseDOY = getNonLeapDayOfYear(baseDateUsed);
      const selectedDOY = getNonLeapDayOfYear(selectedDate);
      const yearDiff = selectedDate.getFullYear() - baseDateUsed.getFullYear();
      const diff = yearDiff * 365 + (selectedDOY - baseDOY);

      // Calcolo del giorno civile
      const civilDay = diff % 365;
      let remainingDays = civilDay;
      let civilMonthName = "";
      let civilDayNumber = 0;
      for (let i = 0; i < civilMonths.length; i++) {
        if (remainingDays < civilMonths[i].days) {
          civilMonthName = civilMonths[i].name;
          civilDayNumber = remainingDays + 1;
          break;
        } else {
          remainingDays -= civilMonths[i].days;
        }
      }
      if (civilMonthName === "") {
        civilMonthName = "Nemontemi (5 giorni infausti)";
        civilDayNumber = remainingDays + 1;
      }

      const sacredDayIndex = diff % 260;
      const sacredNumber = (sacredDayIndex % 13) + 1;
      const sacredName = sacredDayNames[sacredDayIndex % 20];
      const cycleUsed = (selectedDate < baseDate1965) ? "Ciclo 1913" : "Ciclo 1965";
      const mindNumber = sacredDayNames.indexOf(sacredName) + 1;
      const destinyNumber = civilDayNumber + mindNumber + sacredNumber;

      return {
        civil: { month: civilMonthName, day: civilDayNumber },
        sacred: { number: sacredNumber, name: sacredName },
        cycle: cycleUsed,
        mindNumber: mindNumber,
        destiny: destinyNumber
      };
    }

    // Gestione della conversione per una data specifica
    document.getElementById("convertButton").addEventListener("click", () => {
      const inputDate = document.getElementById("inputDate").value;
      const resultDiv = document.getElementById("result");
      if (!inputDate) {
        alert("Per favore, inserisci una data valida.");
        return;
      }
      const result = computeConversion(inputDate);
      if (result.error) {
        alert(result.error);
      } else {
        const civilMonthNumber = getMonthNumber(result.civil.month);
        resultDiv.innerHTML = `
          <p><strong>Spirito:</strong> ${result.civil.day}</p>
          <p><strong>Mente:</strong> ${result.mindNumber}</p>
          <p><strong>Anima:</strong> ${result.sacred.number}</p>
          <p><strong>Simbolo:</strong> ${result.sacred.name}</p>
          <p><strong>Mese Civile:</strong> ${civilMonthNumber} - ${result.civil.month}</p>
          <p><strong>Numero di Destino:</strong> ${result.destiny}</p>
          <p><em>${result.cycle}</em></p>
        `;
      }
    });

    // Vibrazioni Sinusoidali - Animazione su canvas
    const canvas = document.getElementById('sineCanvas');
    const ctx = canvas.getContext('2d');
    let width = canvas.width = canvas.offsetWidth;
    let height = canvas.height = canvas.offsetHeight;
    let offset = 0;
    function drawSine() {
      ctx.clearRect(0, 0, width, height);
      ctx.beginPath();
      ctx.moveTo(0, height / 2);
      for (let x = 0; x < width; x++) {
        let y = height / 2 + 40 * Math.sin((x + offset) * 0.05);
        ctx.lineTo(x, y);
      }
      ctx.strokeStyle = '#000';
      ctx.lineWidth = 2;
      ctx.stroke();
      offset += 2;
      requestAnimationFrame(drawSine);
    }
    drawSine();
    window.addEventListener('resize', () => {
      width = canvas.width = canvas.offsetWidth;
      height = canvas.height = canvas.offsetHeight;
    });
  </script>
</body>
</html>
